version: v1.0
name: Monorepo project
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Test WEB server
    dependencies: []
    run:
      when: 'change_in(''/web-app/'', { default_branch: ''main'' })'
    task:
      jobs:
        - commands:
            - 'true'
            - '# checkout'
            - '# cd web-app'
            - '# make test'
          name: Unit tests
  - name: Test iOS client
    dependencies: []
    run:
      when: 'change_in(''/ios/'', { default_branch: ''main'' })'
    task:
      agent:
        machine:
          type: a1-standard-4
          os_image: macos-xcode12
      jobs:
        - commands:
            - 'true'
            - '# checkout'
            - '# cd ios'
            - '# make test'
          name: Unit tests
  - name: Test docs page
    dependencies: []
    run:
      when: 'change_in(''/docs/'', { default_branch: ''main'' })'
    task:
      jobs:
        - commands:
            - 'true'
            - '# checkout'
            - '# cd docs'
            - '# make test'
          name: Test
  - name: Integration tests
    dependencies:
      - Test WEB server
      - Test iOS client
    run:
      when: 'change_in([''/web-app/'', ''/ios/''], { default_branch: ''main'' })'
    task:
      jobs:
        - commands:
            - 'true'
            - '# checkout'
            - '# make integration-tests'
          name: Run test
